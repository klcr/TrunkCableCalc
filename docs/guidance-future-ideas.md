# ガイダンス機能 — 将来の拡張アイデア

> 現在の Hint ツールチップによるガイダンスは Phase 1。ここでは現在の UI では実現困難だが、将来取り組みたい拡張案を記録する。

## 1. 変圧器不平衡率の可視化

**概要**: 単相負荷（照明・コンセント等）の相間偏りを検知し、不平衡率を表示する。

**必要な UI**:
- 変圧器ノードの結果パネルに相別負荷のブレークダウン表示
- 不平衡率 > 30% で黄色警告、> 50% で赤色エラー
- 「どの負荷をどの相に移動すべきか」の提案

**課題**: 現在の負荷モデルに相（R/S/T）の概念がない。データモデルの拡張が必要。

---

## 2. 保護協調カーブの重畳表示

**概要**: MCCB のトリップカーブ（瞬時・短限時・長限時）とケーブル I²t 許容曲線を同一の時間-電流グラフ上にプロットする。

**必要な UI**:
- 対数目盛の時間（Y）-電流（X）チャート（SVG）
- MCCB トリップバンド（最小-最大）の塗りつぶし領域
- ケーブル I²t = K²S² 曲線
- 交差点の視覚化 → 「保護されない領域」（ケーブルが損傷する前に MCCB が遮断しない領域）のハイライト

**課題**: MCCB メーカー別のトリップカーブデータが必要。現在の `mccb-icu.json` には遮断容量のみで、トリップ特性曲線のデータ点がない。

**段階的アプローチ**:
1. 汎用的な B/C/D カーブ（IEC 60898 準拠）で概算表示
2. メーカーカタログ PDF からデータ点を抽出して精度を上げる

---

## 3. 短絡電流の距離減衰シミュレーション

**概要**: ケーブルこう長に沿った Isc の減衰カーブを表示し、最遠端（末端機器位置）での遮断可能性を視覚化する。

**必要な UI**:
- 距離（X）-短絡電流（Y）の折れ線グラフ
- MCCB 遮断容量を水平ラインで表示
- 交差点 = 「この距離より先では遮断不能」を明示

**課題**: 現在は各ノード位置での点計算のみ。距離をパラメータとした連続計算（10m 刻み等）への拡張が必要。

---

## 4. 選択性（セレクティビティ）チェック

**概要**: 直列に並ぶ上位 MCCB と下位 MCCB の保護選択性を時限特性の比較で評価する。

**必要な確認項目**:
- 下位 MCCB の遮断時間が上位よりも十分短いか
- 上位 MCCB の瞬時トリップが下位の短絡電流領域に干渉しないか
- カスケード遮断（バックアップ保護）の適用可否

**課題**: トリップカーブデータ（アイデア 2 と同じ前提）+ ツリー構造を辿って上位/下位の組み合わせを自動抽出するロジック。

---

## 5. コスト最適化提案

**概要**: ケーブルサイズ × こう長から銅量（または重量 kg）を概算し、ケーブルコストを推定する。電圧格上げ（200V → 400V）時のケーブルコスト比較を提示する。

**表示イメージ**:
```
現行: CVT 60mm² × 80m = 銅量 14.4kg  → 概算 ¥xxx
代替: CVT 22mm² × 80m（400V化）= 銅量 5.3kg → 概算 ¥xxx（△62%）
```

**課題**: ケーブル単価は時期・メーカーにより変動が大きい。概算用の参考単価テーブルを `data/` に追加する必要がある。

---

## 6. 電力損失の見える化

**概要**: 各区間の I²R 損失を算出し、年間電力損失コストを推定する。

**計算**: `P_loss = I² × R × L × K` (三相: K=3, 単相3W: K=2)
**年間コスト**: `P_loss × 稼働時間 × 電力単価`

**表示イメージ**:
- ツリービューに各区間の損失 [W] をアノテーション
- 変圧器からの累積損失を合計表示
- 「ケーブルを 1 段上げると損失が△xx% 削減される」提案

**課題**: 稼働時間・電力単価は入力パラメータとして追加が必要。負荷率（=実際の電流/設計電流）の概念も考慮。

---

## 7. 自動ルート最適化（感度分析）

**概要**: 電圧降下制約内で、こう長をパラメータとして最適ケーブルサイズの境界を感度分析グラフで表示する。

**表示イメージ**:
- こう長（X）-ケーブルサイズ（Y, 離散）のステップグラフ
- 現在の設定点をマーカーで表示
- 「あと +15m 伸ばすと次のサイズが必要」のような知見

**課題**: 計算自体は `runCalc` のこう長パラメータを振るだけで可能。UI（チャート）の実装が主な作業。

---

## 8. 「なぜこのサイズ？」ボタン（Binding Constraint の可視化）

**概要**: 選定結果のケーブルサイズをクリックすると、3 条件（許容電流・電圧降下・保護協調）のどれが binding constraint（律速条件）だったかをステップバイステップで表示する。

**表示イメージ**:
```
サイズ走査ログ:
  8mm²  → ×許容電流 (29A < 54A)
  14mm² → ×許容電流 (44A < 54A)
  22mm² → ×保護協調 (61A < 75AT)
  38mm² → ○ 全条件適合 ← 選定
```

**実装方針**:
1. calc engine（`runCalc`）に各サイズの不適合理由を記録する `scanLog[]` フィールドを追加
2. ResultPanel にポップオーバーで `scanLog` を表示する UI を追加
3. どの条件がサイズを決定したかを色分けで強調

**課題**: calc engine の戻り値に新フィールドを追加する変更。計算パフォーマンスへの影響は軽微（配列追記のみ）。

---

## 優先度の目安

| # | アイデア | 実装難度 | ユーザー価値 | 備考 |
|---|---------|---------|-------------|------|
| 8 | なぜこのサイズ | 低 | 高 | calc engine に scanLog 追加のみ |
| 3 | 距離減衰シミュレーション | 低 | 中 | 既存計算の拡張 |
| 7 | 感度分析 | 中 | 高 | チャート UI が主な作業 |
| 6 | 電力損失の見える化 | 中 | 中 | 入力パラメータ追加 |
| 2 | 保護協調カーブ | 高 | 高 | トリップカーブデータが課題 |
| 4 | 選択性チェック | 高 | 中 | アイデア 2 の前提 |
| 5 | コスト最適化 | 中 | 中 | 単価データの保守 |
| 1 | 不平衡率 | 高 | 低〜中 | データモデル変更が必要 |
