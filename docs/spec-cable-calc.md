# 低圧幹線ケーブル計算ツール — 機能仕様書

## 概要

内線規程 JEAC 8001 および電技解釈に準拠した、低圧幹線のケーブルサイズ・MCCB定格を自動選定するブラウザベースの計算ツール。単一HTMLファイルで動作し、サーバー不要。

最大の特徴は「親幹線の自動生成」で、同一幹線名称の子回路が2件以上登録されると、受変電盤の主幹ブレーカに相当する親幹線を自動的に計算・表示する。

---

## 1. 構成と動作環境

| 項目 | 内容 |
|------|------|
| ファイル形式 | 単一HTMLファイル（HTML + インラインCSS + JSX） |
| 依存ライブラリ | React 18.2.0 / ReactDOM 18.2.0 / Babel Standalone 7.23.9（すべてCDN経由） |
| 動作環境 | モダンブラウザ（Chrome / Edge / Firefox / Safari） |
| サーバー | 不要。ローカルファイルとして開くだけで動作 |
| データ保存 | JSON形式でのImport/Exportによる外部ファイル保存 |

---

## 2. 画面構成

画面は左右2ペインの固定レイアウトで構成される。

| 領域 | 幅 | 内容 |
|------|----|------|
| ヘッダー | 全幅 | ツール名称、Import / Export / PDF出力ボタン |
| 左ペイン | 460px固定 | 入力フォーム（子回路モード / 親幹線モードを切替） |
| 右ペイン上部 | 残り幅 | 選定結果パネル（リアルタイム表示） |
| 右ペイン下部 | 残り幅 | 登録一覧テーブル（親子ツリー表示） |

左右ともペイン内で独立スクロールする（画面高さ - ヘッダー分）。

---

## 3. 入力項目一覧（子回路）

### 3-1. 回路情報

| # | 項目 | 型 | 初期値 | 選択肢・範囲 |
|---|------|-----|--------|-------------|
| 1 | 幹線番号/名称 | テキスト | 空 | 登録時必須。同一名称で子回路をグルーピング |
| 2 | 負荷名称 | テキスト | 空 | 計算書表示用。計算には不使用 |
| 3 | 電気方式 | 選択 | 三相3線式 | 単相2線式 / 単相3線式 / 三相3線式 / 三相4線式 |
| 4 | 電圧 [V] | 選択 | 200 | 電気方式に連動（後述） |
| 5 | 周波数 | 選択 | 60Hz | 50Hz / 60Hz |
| 6 | 供給方式 | 選択 | 低圧受電 | 低圧受電 / 高圧受電 |
| 7 | 回路種別 | 選択 | 一般 | 一般 / 電動機 |
| 8 | MCCB AT | 選択 | 自動 | 自動 / 標準定格から手動選択 |

### 3-2. 負荷条件

| # | 項目 | 型 | 初期値 | 範囲・ステップ |
|---|------|-----|--------|--------------|
| 9 | 負荷容量 | 数値 | 0 | 0以上。単位がAの場合は「電流」として扱う |
| 10 | 単位 | 選択 | kW | kW / kVA / A |
| 11 | 力率 cosθ | 数値 | 0.85 | 0.10〜1.00（ステップ 0.01） |
| 12 | 効率 η | 数値 | 1.0 | 0.10〜1.00。回路種別=電動機のときのみ表示 |
| 13 | 需要率 [%] | 数値 | 100 | 1〜100 |
| 14 | こう長 [m] | 数値 | 30 | 0.1以上（ステップ 0.5） |

### 3-3. ケーブル条件

| # | 項目 | 型 | 初期値 | 選択肢・範囲 |
|---|------|-----|--------|-------------|
| 15 | ケーブル種類 | 選択 | CVT | CVT / CVD / CV-3C / CV-2C |
| 16 | 配線方式 | 選択 | ケーブルラック配線 | ケーブルラック / 配管 / 直埋 / 管路 |
| 17 | 周囲温度 [℃] | 数値 | 40 | 20〜50（ステップ 5） |
| 18 | 多条低減プリセット | 選択 | 1段 S=d 7列以上 | 補正なし(1.0) / 1段S=d 2列(0.85) / 1段S=d 3列(0.80) / 1段S=d 7列以上(0.70) / 2段S=d 2列(0.70) / 2段S=d 3列(0.60) / カスタム |
| 19 | 低減率（カスタム時） | 数値 | 0.70 | 0.10〜1.00。カスタム選択時のみ入力可 |

---

## 4. 入力項目一覧（親幹線）

親幹線モードでは、負荷に関する項目（容量・電流・力率等）は子回路の合計から自動算出される。ユーザーが入力するのはケーブル敷設に関する項目のみ。

| # | 項目 | 型 | 初期値 | 備考 |
|---|------|-----|--------|------|
| 1 | こう長 [m] | 数値 | 10 | 変圧器二次側〜分岐点 |
| 2 | 力率 cosθ | 数値 | 0.85 | 幹線としての合成力率 |
| 3 | ケーブル種類 | 選択 | CVT | CVT / CVD / CV-3C / CV-2C |
| 4 | 配線方式 | 選択 | ケーブルラック配線 | 子回路と独立して設定可能 |
| 5 | 周囲温度 [℃] | 数値 | 40 | 20〜50 |
| 6 | 多条低減 | 選択 | 1段 S=d 7列以上 | プリセットまたはカスタム |
| 7 | MCCB AT | 選択 | 自動 | 自動 / 手動指定 |

親幹線モードでは、子回路の情報が参照表示される（子回路数、合計電流、電動機/一般の内訳）。

---

## 5. 連動制御

| トリガー | 対象 | 動作 |
|---------|------|------|
| 電気方式を変更 | 電圧の選択肢 | 新方式に対応する電圧リストに切替。現在値が存在しなければ先頭値にリセット |
| 回路種別を「電動機」に | 効率ηの入力欄 | 表示する |
| 回路種別を「一般」に | 効率ηの入力欄 | 非表示にし、内部値を1.0にリセット |
| 負荷単位を「A」に | ラベル表示 | 「電流 [A]」に切替 |
| 多条低減プリセットを変更 | 低減率の値 | 対応する数値を自動セット |
| プリセット「カスタム」を選択 | 低減率入力欄 | 手動入力欄を表示 |
| 配線方式を直埋/管路に変更 | 温度補正テーブル | 基底25℃の地中テーブルに切替 |
| 配線方式をラック/配管に変更 | 温度補正テーブル | 基底40℃の気中テーブルに切替 |

### 電気方式と電圧の対応

| 電気方式 | 選択可能な電圧 [V] |
|----------|-------------------|
| 単相2線式 | 100, 200 |
| 単相3線式 | 100, 200（表示は「100/200」） |
| 三相3線式 | 200, 210, 400, 415, 440 |
| 三相4線式 | 200 |

---

## 6. 入力確定タイミング

### 即時反映（onChange）

セレクトボックス系の項目はすべて、選択と同時に計算を再実行する。

対象: 電気方式、電圧、周波数、供給方式、回路種別、負荷単位、ケーブル種類、配線方式、多条低減プリセット、MCCB AT指定

### 確定時に反映（onBlur）

数値入力は、フォーカスが外れたタイミング（またはスライダーのつまみを離したタイミング）で計算を再実行する。入力途中の中間状態では計算が走らない。

対象: 負荷容量、こう長、力率、効率、需要率、周囲温度、低減率（カスタム時）

---

## 7. 数値入力のスライダーUI

数値入力ボックスにはスライダーポップアップが付属する。

### 動作フロー

1. 入力ボックスをクリック（フォーカス取得）
2. ボックス直下にスライダーがポップアップ表示。つまみは中央位置
3. つまみをドラッグすると、現在値を起点として値が増減。入力値はリアルタイムに表示更新される（計算は未発火）
4. つまみを離すと値が確定し、計算が再実行。つまみは中央に復帰
5. ポップアップ外をクリックまたは別入力にフォーカス移動で閉じる

### スライダーの感度

| 対象項目 | ステップ | 片側の最大変動量 |
|---------|---------|----------------|
| 負荷容量 (kW/kVA) | 0.1 | ±100 |
| 負荷容量 (A) | 1 | ±200 |
| 力率 cosθ | 0.01 | ±0.30 |
| 効率 η | 0.01 | ±0.30 |
| 需要率 [%] | 1 | ±50 |
| こう長 [m] | 0.5 | ±100 |
| 周囲温度 [℃] | 5 | ±15 |
| 低減率（カスタム） | 0.01 | ±0.30 |

---

## 8. 計算ロジック

### 8-1. 設計電流の算出

負荷単位に応じて算出方法が切り替わる。

| 単位 | 三相3線式 / 三相4線式 | 単相2線式 / 単相3線式 |
|------|---------------------|---------------------|
| kW | I = P × 1000 / (√3 × V × cosθ × η) | I = P × 1000 / (V × cosθ × η) |
| kVA | I = S × 1000 / (√3 × V) | I = S × 1000 / V |
| A | 入力値をそのまま使用 | 入力値をそのまま使用 |

需要率を乗じて設計電流とする: `設計電流 = 算出電流 × 需要率[%] / 100`

### 8-2. 電動機回路の電流補正（内線規程 3705-6）

回路種別が「電動機」の場合、ケーブルサイジング用の電流を算出する。

| 条件 | サイジング電流 |
|------|--------------|
| 設計電流 ≦ 50A | 設計電流 × 1.25 |
| 設計電流 > 50A | 設計電流 × 1.1 |

### 8-3. ケーブルサイズの自動選定

以下の順で、3条件をすべて満たす最小のケーブル断面積を選定する。

```
Step 1: 許容電流による仮選定
  実効許容電流 = 基本許容電流 × 温度補正係数 × 多条低減率
  → 実効許容電流 ≧ サイジング電流 を満たす最小サイズを選択

Step 2: 電圧降下の確認
  e = K × I × (L / 1000) × Z  [V]
  Z = R × cosθ + X × sinθ     [Ω/km]
  電圧降下率 = e / 基準電圧 × 100  [%]
  → 許容値以内か判定。NGならサイズを1ランクアップしてStep 1に戻る

Step 3: 保護協調の確認
  一般回路:   実効許容電流 ≧ MCCB AT
  電動機回路: 実効許容電流 ≧ MCCB AT / 2.5
  → 不適合ならケーブルサイズアップ
```

全サイズで条件を満たせない場合は、最大サイズ（325mm²）を選定し、NG表示とする。

### 8-4. 電圧降下計算の係数

| 電気方式 | K値 | 基準電圧 |
|---------|-----|---------|
| 単相2線式 | 2 | 線間電圧（100V/200V） |
| 単相3線式 | 1 | 対地電圧 100V |
| 三相3線式 | √3 (≈ 1.732) | 線間電圧 |
| 三相4線式 | 1 | 対地電圧 |

単相3線式ではK=1、基準電圧=100Vで計算する（大地間電圧基準）。

### 8-5. 許容電圧降下

こう長と供給方式から許容電圧降下率が決まる。

| こう長 | 高圧受電 | 低圧受電 |
|-------|---------|---------|
| 60m以下 | 3% | 2% |
| 60m超〜120m | 5% | 4% |
| 120m超〜200m | 6% | 5% |
| 200m超 | 7% | 6% |

### 8-6. MCCB定格の自動選定

「自動」選択時、設計電流以上の最小標準定格を選定する。

| 回路種別 | 選定基準 |
|---------|---------|
| 一般 | 設計電流以上の最小AT |
| 電動機 | 設計電流 × 1.25 以上の最小AT |

MCCB標準定格: 15, 20, 25, 30, 32, 40, 50, 60, 63, 75, 100, 125, 150, 175, 200, 225, 250, 300, 350, 400, 500, 600, 630, 700, 800 [AT]

### 8-7. 温度補正係数

基底温度からのずれに応じて許容電流を補正する。テーブル外の中間温度は線形補間で算出する。

**気中布設（ケーブルラック・配管） — 基底 40℃:**

| 温度 [℃] | 20 | 25 | 30 | 35 | 40 | 45 | 50 |
|----------|-----|-----|-----|-----|-----|-----|-----|
| 係数 | 1.18 | 1.14 | 1.10 | 1.05 | 1.00 | 0.95 | 0.89 |

**地中布設（直埋・管路） — 基底 25℃:**

| 温度 [℃] | 20 | 25 | 30 | 35 | 40 | 45 | 50 |
|----------|-----|-----|-----|-----|-----|-----|-----|
| 係数 | 1.04 | 1.00 | 0.96 | 0.92 | 0.88 | 0.83 | 0.78 |

---

## 9. 親幹線の自動生成

### 9-1. 生成条件

同一の「幹線番号/名称」で子回路が **2件以上** 登録されると、自動的に親幹線（主幹ブレーカ相当）が生成される。1件のみの幹線名には親幹線は生成されない。

### 9-2. 親幹線の位置づけ

```
受変電盤 主幹ブレーカ (=親幹線)
  ├── 分岐回路1 (=子回路)
  ├── 分岐回路2 (=子回路)
  └── 分岐回路3 (=子回路)
```

分岐点は同一（受変電盤二次側）と想定する。親幹線の電気方式・電圧・周波数・供給方式は、最初に登録された子回路の設定を継承する。

### 9-3. 親幹線の電流算出

子回路の設計電流を回路種別ごとに集計し、電動機の有無で計算が分岐する。

```
ΣIM = 電動機回路の設計電流の合計
ΣIH = 一般回路の設計電流の合計
合計電流 = ΣIM + ΣIH
```

**電動機が1回路でも含まれる場合（電動機混在）:**

| 条件 | サイジング電流 |
|------|--------------|
| ΣIM ≦ 50A | ΣIM × 1.25 + ΣIH |
| ΣIM > 50A | ΣIM × 1.1 + ΣIH |

**電動機が含まれない場合:**

サイジング電流 = 合計電流（補正なし）

### 9-4. 親幹線のMCCB選定

| 条件 | 選定基準 |
|------|---------|
| 電動機混在 | 合計電流 × 1.25 以上の最小AT |
| 電動機なし | 合計電流以上の最小AT |

### 9-5. 親幹線の保護協調

| 条件 | 合格基準 |
|------|---------|
| 電動機混在 | 実効許容電流 ≧ MCCB AT / 2.5 |
| 電動機なし | 実効許容電流 ≧ MCCB AT |

不適合の場合はケーブルサイズを自動でアップサイズする。

### 9-6. 親幹線の編集

登録一覧の `[主幹]` 行をクリックすると、左ペインが親幹線編集モードに切り替わる。子回路の負荷情報は自動集計のため編集不可。ユーザーが編集できるのはケーブル敷設条件（こう長、力率、ケーブル種類、配線方式、温度、低減率、MCCB AT）のみ。

「親幹線を保存」ボタンで設定を確定し、子回路編集モードに戻る。

---

## 10. 内蔵データテーブル

### 10-1. インピーダンステーブル

日本電線工業会 技資第103号Aに基づく、導体温度90℃の値 [Ω/km]。ケーブル種類と周波数の組み合わせで4パターンを保持する。

**CVケーブル（CV-2C, CV-3C）用:** 2〜325mm² の13サイズ、50Hz/60Hzの各 [R, X]

**CVT/CVDケーブル用:** 8〜325mm² の10サイズ、50Hz/60Hzの各 [R, X]

CVT/CVDは導体間隔が広いためリアクタンスXがCV多心より大きい。60Hzのリアクタンスは50Hzの約1.2倍。

### 10-2. 許容電流テーブル

JCS 0168-2:2016に基づく、周囲温度40℃（気中）/ 25℃（地中）の基本許容電流 [A]。4つの配線方式それぞれについて、4種のケーブル（CVT / CVD / CV-3C / CV-2C）の許容電流を保持する。

| 配線方式 | テーブル名 | 基底温度 |
|---------|----------|---------|
| ケーブルラック配線 | 気中暗渠（コロガシ/ラック） | 40℃ |
| 配管配線 | 電線管布設 | 40℃ |
| 直埋布設 | 直接埋設 | 25℃ |
| 管路布設 | 管路引入れ | 25℃ |

許容電流の大小関係: ケーブルラック > 直埋 > 配管 ≧ 管路

### 10-3. 対応ケーブルサイズ

| ケーブル種類 | 対応断面積 [mm²] |
|------------|-----------------|
| CV-2C, CV-3C | 2, 3.5, 5.5, 8, 14, 22, 38, 60, 100, 150, 200, 250, 325 |
| CVT, CVD | 8, 14, 22, 38, 60, 100, 150, 200, 250, 325 |

---

## 11. 選定結果の表示

### 11-1. 合否判定バッジ

3つの判定項目それぞれに○/×のバッジを表示し、全条件の総合判定を表示する。

| 判定項目 | 合格条件（一般） | 合格条件（電動機） |
|---------|---------------|-----------------|
| 許容電流 | 実効許容電流 ≧ サイジング電流 | 同左 |
| 電圧降下 | 電圧降下率 ≦ 許容値 | 同左 |
| 保護協調 | 実効許容電流 ≧ MCCB AT | 実効許容電流 ≧ MCCB AT / 2.5 |

### 11-2. 表示項目

**主要結果（3項目、強調表示）:**

選定ケーブル（種類+断面積）、MCCB定格 [AT]、設計電流 [A]（親幹線の場合は「合計電流」）

**許容電流の詳細（4項目）:**

基本許容電流 [A]、温度補正係数、低減率、実効許容電流 [A]

**電圧降下の詳細（4項目）:**

合成インピーダンスZ [Ω/km]、方式係数K、電圧降下 [V] (%)、許容値 [V] (%)

**電動機回路の補足情報:**

電動機混在時はサイジング電流の内訳（電動機/一般の分離と補正率）および保護協調の閾値（AT/2.5）を補足表示する。

---

## 12. 登録一覧と親子ツリー表示

### 12-1. 表示構造

登録されたレコードは幹線番号/名称でグルーピングし、以下のツリー構造で表示する。

```
[主幹] L-101          三相3線式  200V  120A  CVT 60   200  3.2V(1.6%)  OK
  └ 電灯No.1          三相3線式  200V   40A  CVT 14    63  1.1V(0.5%)  OK
  └ 動力No.1          三相3線式  200V   80A  CVT 38   100  2.0V(1.0%)  OK
LG-102                 単相2線式  200V   25A  CV-2C 5.5  30  2.5V(1.3%)  OK
```

同一幹線名が1件のみの場合は、幹線名をそのまま表示（親幹線行なし）。2件以上になると `[主幹]` 行が自動的に先頭に挿入される。

### 12-2. テーブルカラム

| カラム | 内容 |
|--------|------|
| （種別） | `[主幹]` または `└`（子回路のインデント） |
| 幹線/負荷名 | 親=幹線名、子=負荷名称（親子構造時） |
| 方式 | 電気方式 |
| 電圧 | 電圧 [V] |
| 設計I | 設計電流 [A] |
| ケーブル | 選定結果（種類+断面積） |
| AT | MCCB定格電流 [AT] |
| e [V] | 電圧降下 [V] (%) |
| 判定 | OK / NG |
| 削除 | x ボタン（子回路のみ） |

### 12-3. 行クリック操作

| クリック対象 | 動作 |
|-------------|------|
| `[主幹]` 行 | 左ペインが親幹線編集モードに切替。結果パネルに親幹線の選定結果を表示 |
| 子回路行 | 左ペインに該当レコードの入力値を復元し、編集モードに切替 |
| x ボタン | 該当子回路を削除（クリックイベントは行クリックに伝播しない） |

---

## 13. 登録・更新・削除

### 登録

「+ 登録」ボタンを押すと、現在の入力値と計算結果をレコードとして保存する。

前提条件:
- 幹線番号/名称が空でないこと
- 負荷容量 > 0 かつ こう長 > 0 であること（計算結果が存在すること）

同一幹線名で2件目が登録された時点で、親幹線の設定データが初期値で自動生成される。

### 更新

一覧から子回路行をクリックすると、入力フォームにその値が復元される。ボタンが「更新」に変わり、押すと既存レコードを上書きする。「取消」で新規入力モードに戻る。

### 削除

各子回路行の右端にある x ボタンで削除する。削除により同一幹線名のレコードが1件以下になると、親幹線行は自動的に消える。

---

## 14. Import / Export

### Export

ヘッダーの「Export」ボタンで、全登録データと親幹線設定をJSON形式でダウンロードする。

ファイル名: `幹線計算_YYYY-MM-DD.json`

データ構造:
```json
{
  "records": [
    {
      "id": "タイムスタンプ文字列",
      "params": { "入力パラメータ一式" },
      "result": { "計算結果一式" },
      "ts": "ISO 8601 タイムスタンプ"
    }
  ],
  "parentCfgs": {
    "幹線名": {
      "cableLength": 10,
      "cableType": "CVT",
      "wiringMethod": "ケーブルラック配線",
      "ambientTemp": 40,
      "reductionPreset": "1段 S=d 7列以上",
      "reductionFactor": 0.70,
      "mccbATOverride": "自動",
      "powerFactor": 0.85
    }
  }
}
```

### Import

ヘッダーの「Import」ボタンでJSONファイルを読み込み、既存データに追記する。`records` と `parentCfgs` の両方を復元する。旧形式（配列のみ）との後方互換性あり。

---

## 15. PDF出力

ヘッダーの「PDF出力」ボタンで、公共建築工事標準仕様書 様式 電-8-1 に準じた電路計算書をHTML形式で新規ウィンドウに表示し、ブラウザの印刷ダイアログを起動する。

### 用紙設定

A3横向き、余白8mm

### 出力項目

ヘッダー行: 幹線番号/名称、電気方式、電圧[V]、遮断器[AT]、負荷名称、負荷容量[kW]、設計電流[A]、L[m]、許容電流（種別/太さ、配線、許容[A]、低減率、補正後[A]）、電圧降下（K、cosθ、Z、e[V]、許容e[V]）

親幹線行は太字・背景色付きで区別表示される。子回路行はインデントして表示する。

フッターに計算式の注記を記載:
- e = KIlZ/1000 [V] の定義
- K値の一覧
- 保護協調の判定基準

---

## 16. 準拠規格

| 規格・法規 | 適用範囲 |
|-----------|---------|
| 内線規程 JEAC 8001 | 許容電圧降下（1310節）、電動機回路の幹線太さ基準（3705節） |
| 電技解釈 第148条 | 低圧幹線の施設（許容電流、MCCB定格、保護協調） |
| JCS 0168-1/2:2016 | ケーブル許容電流計算の式と定数、低圧ケーブル許容電流表 |
| 日本電線工業会 技資第103号A | CVケーブルのインピーダンス表（導体温度90℃） |
| JIS C 3605 / C 3606 | 600V CVケーブル / CVTケーブルの規格 |
| JIS C 8201-2-1 | 配線用遮断器（MCCB）の規格 |

---

## 17. 技術的な実装仕様

### 状態管理

入力値は2層で管理する。`live`（表示用・リアルタイム追従）と `calc`（計算用・確定値のみ）を分離し、数値入力中の不要な再計算を防止している。セレクトボックスは両方を即座に更新し、数値入力はフォーカスアウト時にのみ `calc` を更新する。

### 計算の再実行タイミング

`calc` の値が変更されるたびに `useMemo` で計算が再実行される。親幹線の計算結果も `useMemo` で子回路のレコード変更や親設定の変更に追従する。

### ライブラリ

- React 18.2.0 — UI描画
- ReactDOM 18.2.0 — DOMレンダリング
- Babel Standalone 7.23.9 — ブラウザ内でのJSXトランスパイル

すべて cdnjs.cloudflare.com からCDN読み込み。ビルド工程は不要。
